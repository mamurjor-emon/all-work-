<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <svg aria-hidden="true" style="position: absolute; width: 0; height: 0; overflow: hidden;" version="1.1"
        xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <defs>
            <symbol id="icon-cross" viewBox="0 0 32 32">
                <title>close</title>
                <path
                    d="M31.7 25.7L22 16l9.7-9.7a1 1 0 0 0 0-1.4L27.1.3a1 1 0 0 0-1.4 0L16 10 6.3.3a1 1 0 0 0-1.4 0L.3 4.9a1 1 0 0 0 0 1.4L10 16 .3 25.7a1 1 0 0 0 0 1.4l4.6 4.6a1 1 0 0 0 1.4 0L16 22l9.7 9.7a1 1 0 0 0 1.4 0l4.6-4.6a1 1 0 0 0 0-1.4z" />
            </symbol>
        </defs>
    </svg>

    <div class="page" data-modal-state="closed">
        <div class="container">
            <div class="card-slider">
                <div class="card-wrapper">
                    <article class="card">
                        <picture class="card__background">
                            <img src="https://source.unsplash.com/random">
                        </picture>
                        <div class="card__category">
                            consulta
                        </div>
                        <h3 class="card__title">Asesoría Angelical</h3>
                        <div class="card__duration">
                            Duración: 3 horas
                        </div>
                    </article>
                </div>
                <div class="card-wrapper">
                    <article class="card">
                        <picture class="card__background">
                            <img src="https://source.unsplash.com/random">
                        </picture>
                        <div class="card__category">
                            consulta
                        </div>
                        <h3 class="card__title">Asesoría Angelical</h3>
                        <div class="card__duration">
                            Duración: 3 horas
                        </div>
                    </article>
                </div>
                <div class="card-wrapper">
                    <article class="card">
                        <picture class="card__background">
                            <img src="https://source.unsplash.com/random">
                        </picture>
                        <div class="card__category">
                            consulta
                        </div>
                        <h3 class="card__title">Asesoría Angelical</h3>
                        <div class="card__duration">
                            Duración: 3 horas
                        </div>
                    </article>
                </div>
                <div class="card-wrapper">
                    <article class="card">
                        <picture class="card__background">
                            <img src="https://source.unsplash.com/random">
                        </picture>
                        <div class="card__category">
                            consulta
                        </div>
                        <h3 class="card__title">Asesoría Angelical</h3>
                        <div class="card__duration">
                            Duración: 3 horas
                        </div>
                    </article>
                </div>
                <div class="card-wrapper">
                    <article class="card">
                        <picture class="card__background">
                            <img src="https://source.unsplash.com/random">
                        </picture>
                        <div class="card__category">
                            consulta
                        </div>
                        <h3 class="card__title">Asesoría Angelical</h3>
                        <div class="card__duration">
                            Duración: 3 horas
                        </div>
                    </article>
                </div>
            </div>
        </div>
        <div class="overlay"></div>
        <div class="modal-wrapper">
            <div class="modal">
                <button class="modal__close-button" type="button">
                    <svg class="icon icon-cross">
                        <use xlink:href="#icon-cross"></use>
                    </svg>
                </button>
                <div class="modal__scroll-area">
                    <header class="modal__header">
                        <div class="card__background">
                            <img src="https://source.unsplash.com/random">
                        </div>
                        <div class="card__category">
                            consulta
                        </div>
                        <h1 class="card__title">Asesoría Angelical</h1>
                        <div class="card__duration">
                            Duración: 3 horas
                        </div>
                    </header>
                    <main class="modal__content">
                        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Possimus quo sint debitis? Dolorem
                            est at voluptatum obcaecati tempore eaque perferendis. Totam at consectetur commodi porro
                            atque eligendi rerum vero nam?</p>
                        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Possimus quo sint debitis? Dolorem
                            est at voluptatum obcaecati tempore eaque perferendis. Totam at consectetur commodi porro
                            atque eligendi rerum vero nam?</p>
                        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Possimus quo sint debitis? Dolorem
                            est at voluptatum obcaecati tempore eaque perferendis. Totam at consectetur commodi porro
                            atque eligendi rerum vero nam?</p>
                    </main>
                </div>
            </div>
        </div>
    </div>
</body>

</html>

<script>
    jQuery('.card-slider').slick({
        slidesToShow: 3,
        autoplay: true,
        slidesToScroll: 1,
        dots: false,
        responsive: [{
                breakpoint: 768,
                settings: {
                    slidesToShow: 2
                }
            },
            {
                breakpoint: 600,
                settings: {
                    slidesToShow: 1
                }
            }
        ]
    });

    let cards = document.querySelectorAll('.card');
    let card;
    let modal = document.querySelector('.modal');
    let closeButton = document.querySelector('.modal__close-button');
    let page = document.querySelector('.page');
    const cardBorderRadius = 20;
    const openingDuration = 600; //ms
    const closingDuration = 600; //ms
    const timingFunction = 'cubic-bezier(.76,.01,.65,1.38)';

    var Scrollbar = window.Scrollbar;
    Scrollbar.init(document.querySelector('.modal__scroll-area'));


    function flipAnimation(first, last, options) {
        let firstRect = first.getBoundingClientRect();
        let lastRect = last.getBoundingClientRect();

        let deltas = {
            top: firstRect.top - lastRect.top,
            left: firstRect.left - lastRect.left,
            width: firstRect.width / lastRect.width,
            height: firstRect.height / lastRect.height
        };

        return last.animate([{
            transformOrigin: 'top left',
            borderRadius: `
    ${cardBorderRadius/deltas.width}px / ${cardBorderRadius/deltas.height}px`,
            transform: `
      translate(${deltas.left}px, ${deltas.top}px) 
      scale(${deltas.width}, ${deltas.height})
    `
        }, {
            transformOrigin: 'top left',
            transform: 'none',
            borderRadius: `${cardBorderRadius}px`
        }], options);
    }

    cards.forEach((item) => {
        item.addEventListener('click', (e) => {
            jQuery('.card-slider').slick('slickPause');
            card = e.currentTarget;
            page.dataset.modalState = 'opening';
            card.classList.add('card--opened');
            card.style.opacity = 0;
            document.querySelector('body').classList.add('no-scroll');

            let animation = flipAnimation(card, modal, {
                duration: openingDuration,
                easing: timingFunction,
                fill: 'both'
            });

            animation.onfinish = () => {
                page.dataset.modalState = 'open';
                animation.cancel();
            };
        });
    });

    closeButton.addEventListener('click', (e) => {
        page.dataset.modalState = 'closing';
        document.querySelector('body').classList.remove('no-scroll');

        let animation = flipAnimation(card, modal, {
            duration: closingDuration,
            easing: timingFunction,
            direction: 'reverse',
            fill: 'both'
        });

        animation.onfinish = () => {
            page.dataset.modalState = 'closed';
            card.style.opacity = 1;
            card.classList.remove('card--opened');
            jQuery('.card-slider').slick('slickPlay');
            animation.cancel();
        };
    });
</script>